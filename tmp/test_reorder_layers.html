<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Layer Reordering</title>
</head>
<body>
    <h1>Test Layer Reordering</h1>
    <div id="output"></div>

    <script type="module">
        import { Level } from '../src/models/Level.js';

        const output = document.getElementById('output');

        function log(message) {
            console.log(message);
            output.innerHTML += `<div>${message}</div>`;
        }

        log('ðŸ§ª Testing layer reordering...');

        // Create level
        const level = new Level();

        // Add layers
        level.addLayer('Layer A');
        level.addLayer('Layer B');
        level.addLayer('Layer C');

        log('Initial layers:');
        level.layers.forEach((layer, index) => {
            log(`  ${index}: ${layer.name} (ID: ${layer.id})`);
        });

        // Get original IDs
        const originalIds = level.layers.map(l => l.id);
        const mainLayerId = level.getMainLayerId();

        log(`\nOriginal layer IDs: [${originalIds.join(', ')}]`);
        log(`Main layer ID: ${mainLayerId}`);

        // Reorder: move Main to position 2
        const newOrder = [...originalIds];
        const mainIndex = newOrder.indexOf(mainLayerId);
        newOrder.splice(mainIndex, 1);
        newOrder.splice(2, 0, mainLayerId);

        log(`\nNew order: [${newOrder.join(', ')}]`);
        level.reorderLayers(newOrder);

        log('\nLayers after reordering:');
        level.layers.forEach((layer, index) => {
            log(`  ${index}: ${layer.name} (ID: ${layer.id})`);
        });

        // Verify Main layer is still first in the array
        const newMainLayerId = level.getMainLayerId();
        log(`\nMain layer ID after reorder: ${newMainLayerId}`);
        log(`Main layer ID consistent: ${mainLayerId === newMainLayerId ? 'YES' : 'NO'}`);
        log(`Main layer is first: ${level.layers[0].id === mainLayerId ? 'YES' : 'NO'}`);

        // Test that reordering doesn't change the Main layer ID
        const finalIds = level.layers.map(l => l.id);
        log(`\nFinal layer IDs: [${finalIds.join(', ')}]`);
        log(`IDs preserved: ${JSON.stringify(originalIds) === JSON.stringify(finalIds) ? 'YES' : 'NO'}`);

        log('\nðŸŽ‰ Reordering test completed!');
    </script>
</body>
</html>
