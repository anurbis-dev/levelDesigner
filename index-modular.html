<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Level Editor - Modular</title>
    <!-- Подключаем Tailwind CSS для быстрой стилизации -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Дополнительные стили для улучшения внешнего вида и функциональности */
        body, html {
            overflow: hidden; /* Запрещаем прокрутку всей страницы */
            height: 100%;
            user-select: none; /* Отключаем выделение текста */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        /* Разрешаем выделение текста только в input полях */
        input, textarea {
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        /* Стили для разделителей, которые позволят менять размеры панелей */
        .resizer {
            background-color: #374151; /* gray-700 */
            cursor: col-resize;
            width: 6px;
            flex-shrink: 0;
        }
        .resizer-y {
            background-color: #374151; /* gray-700 */
            cursor: row-resize;
            height: 6px;
            flex-shrink: 0;
        }
        /* Стили для холста (основной рабочей зоны) */
        #main-canvas {
            display: block;
            width: 100%;
            height: 100%;
            background-color: #4B5563; /* gray-600 */
        }
        /* Стили для табов */
        .tab, .tab-right {
            transition: background-color 0.2s;
        }
        .tab.active, .tab-right.active {
            background-color: #374151; /* gray-700 */
            border-bottom-color: transparent;
        }
        /* Стили для превью ассетов */
        .asset-thumbnail {
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        .asset-thumbnail.selected {
            border-color: #3B82F6; /* blue-500 */
        }
        /* Стили для рамки выделения в панели ассетов */
        #asset-marquee {
            position: absolute;
            border: 1px solid rgba(59, 130, 246, 0.8);
            background-color: rgba(59, 130, 246, 0.2);
            pointer-events: none; /* чтобы не мешала кликам */
            z-index: 100;
        }
        /* Стили для аутлайнера */
        .outliner-item {
            padding: 2px 5px;
            border-radius: 3px;
            cursor: pointer;
            white-space: nowrap;
        }
        .outliner-item:hover {
            background-color: #374151;
        }
        .outliner-item.selected {
            background-color: #3B82F6;
        }
        .outliner-group-header {
            cursor: pointer;
            font-weight: bold;
            user-select: none;
        }
        .outliner-group-header::before {
            content: '▼ ';
            display: inline-block;
            transition: transform 0.2s;
        }
        .outliner-group-header.collapsed::before {
            transform: rotate(-90deg);
        }
        /* Стили для перетаскивания группы для создания префаба */
        #assets-panel.drop-target {
            box-shadow: 0 0 0 3px #3B82F6 inset;
        }
    </style>
</head>
<body class="bg-gray-800 text-white font-sans flex flex-col h-screen">

    <!-- 1. Основное меню сверху -->
    <header class="bg-gray-900 shadow-md flex-shrink-0">
        <nav class="flex items-center space-x-4 p-2">
            <div class="relative group" id="menu-level">
                <button class="px-3 py-1 rounded hover:bg-gray-700 transition">Level</button>
                <div class="absolute left-0 mt-1 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-20 hidden">
                    <a href="#" id="new-level" class="block px-4 py-2 text-sm hover:bg-gray-700">New Level</a>
                    <a href="#" id="open-level" class="block px-4 py-2 text-sm hover:bg-gray-700">Open Level...</a>
                    <a href="#" id="save-level" class="block px-4 py-2 text-sm hover:bg-gray-700">Save Level</a>
                    <a href="#" id="save-level-as" class="block px-4 py-2 text-sm hover:bg-gray-700">Save Level As...</a>
                </div>
            </div>
            <div class="relative group" id="menu-settings">
                <button class="px-3 py-1 rounded hover:bg-gray-700 transition">Settings</button>
                <div class="absolute left-0 mt-1 w-48 bg-gray-800 rounded-md shadow-lg py-1 z-20 hidden">
                    <a href="#" id="assets-path" class="block px-4 py-2 text-sm hover:bg-gray-700">Assets Path...</a>
                    <a href="#" id="editor-settings" class="block px-4 py-2 text-sm hover:bg-gray-700">Editor Settings...</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- Основной контейнер с рабочими зонами -->
    <div class="flex flex-grow min-h-0">
        <!-- 2. Main Frame (основная рабочая зона) -->
        <main id="main-panel" class="flex-grow flex flex-col bg-gray-700 p-1">
            <canvas id="main-canvas"></canvas>
        </main>

        <!-- Разделитель для изменения ширины правой панели -->
        <div id="resizer-x" class="resizer"></div>

        <!-- 4. Панель Details (справа) -->
        <aside id="right-panel" class="w-80 bg-gray-900 flex flex-col flex-shrink-0">
            <div class="flex border-b border-gray-700 flex-shrink-0">
                <button data-tab="details" class="tab-right flex-1 p-2 text-sm font-medium active">Details</button>
                <button data-tab="level" class="tab-right flex-1 p-2 text-sm font-medium">Level</button>
                <button data-tab="outliner" class="tab-right flex-1 p-2 text-sm font-medium">Outliner</button>
            </div>
            <div class="flex-grow overflow-y-auto">
                <div id="details-content-panel" class="p-4 tab-content-right">
                     <p class="text-gray-400">Select an object to see its properties.</p>
                </div>
                 <div id="level-content-panel" class="p-4 tab-content-right hidden">
                    <h3 class="text-md font-bold mb-2">Level Stats</h3>
                    <div id="level-stats-content"></div>
                </div>
                <div id="outliner-content-panel" class="p-4 tab-content-right hidden">
                     <!-- Outliner content here -->
                </div>
            </div>
        </aside>
    </div>

    <!-- Разделитель для изменения высоты нижней панели -->
    <div id="resizer-y" class="resizer-y"></div>

    <!-- 3. Assets Drawer (панель с ассетами) -->
    <footer id="assets-panel" class="h-64 bg-gray-900 flex-shrink-0 flex flex-col relative">
        <div id="asset-tabs-container" class="flex border-b border-gray-700">
            <!-- Табы будут генерироваться динамически -->
        </div>
        <div id="asset-previews-container" class="flex-grow p-4 overflow-auto">
            <!-- Контейнер для превью ассетов будет генерироваться динамически -->
        </div>
    </footer>

    <!-- Логика приложения -->
    <script type="module">
        import { LevelEditor } from './src/core/LevelEditor.js';

        // Initialize the level editor
        const editor = new LevelEditor();
        
        // Setup menu dropdowns
        const menuLevel = document.getElementById('menu-level');
        const menuSettings = document.getElementById('menu-settings');
        
        [menuLevel, menuSettings].forEach(menu => {
            const button = menu.querySelector('button');
            const dropdown = menu.querySelector('div');
            button.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = dropdown.classList.contains('hidden');
                // Close all menus first
                document.querySelectorAll('#menu-level > div, #menu-settings > div').forEach(d => d.classList.add('hidden'));
                if (isHidden) {
                    dropdown.classList.remove('hidden');
                }
            });
        });
        
        window.addEventListener('click', () => {
            document.querySelectorAll('#menu-level > div, #menu-settings > div').forEach(d => d.classList.add('hidden'));
        });

        // Initialize the editor
        editor.init().catch(error => {
            console.error('Failed to initialize level editor:', error);
            console.error('Error details:', error);
            alert('Failed to initialize level editor: ' + (error.message || error));
        });
    </script>
</body>
</html>
