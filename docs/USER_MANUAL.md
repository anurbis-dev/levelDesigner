# Руководство пользователя - 2D Level Editor v3.4.0

## Введение

2D Level Editor - это инструмент для создания уровней 2D игр. Редактор предоставляет интуитивный интерфейс для размещения объектов, создания групп и управления свойствами элементов уровня.

## Новые возможности v3.4.0

### Улучшенная логика отображения Group/Ungroup
- **Group при множественном выделении** - пункт Group появляется при выделении 2+ объектов любого типа
- **Ungroup при наличии групп** - пункт Ungroup появляется при наличии хотя бы одной группы в выделении
- **Одновременное отображение** - оба пункта могут показываться одновременно в соответствующих ситуациях
- **Интеллектуальная логика** - автоматическое определение доступных операций на основе выделения
- **Улучшенный UX** - более предсказуемое поведение контекстного меню

### Непрерывный мониторинг позиции курсора во время анимации (v3.3.0)
- **Мониторинг в реальном времени** - позиция курсора отслеживается каждый кадр во время анимации
- **Немедленное закрытие при выходе** - меню закрывается сразу если курсор вышел за границы
- **Надежная защита от быстрых движений** - предотвращает все проблемы с резким движением курсора
- **Оптимизированная производительность** - использует requestAnimationFrame для эффективного мониторинга
- **Автоматическое управление** - мониторинг запускается и останавливается автоматически

### Умное позиционирование курсора для контекстных меню (v3.1.0)
- **Автоматическое позиционирование** - меню корректирует позицию, чтобы курсор оказался внутри
- **Защита от преждевременного закрытия** - предотвращает случайное закрытие при открытии
- **Универсальная поддержка** - работает для всех типов меню (Canvas, Console)
- **Упрощенное закрытие** - меню закрывается при уводе курсора за границы
- **Оптимизированное поведение** - 2px отступ обеспечивает надежную работу

## Интерфейс

### Основные панели

1. **Меню** (верхняя панель) - управление файлами, настройками и режимами отображения
2. **Canvas** (центральная область) - основная рабочая зона для размещения объектов
3. **Панель ассетов** (нижняя панель) - библиотека доступных объектов
4. **Правая панель** - детали объектов, статистика уровня и иерархия

### Настройка размеров панелей

Редактор позволяет настраивать размеры панелей для удобной работы:

- **Вертикальный разделитель** (между canvas и правой панелью) - перетащите для изменения ширины правой панели
- **Горизонтальный разделитель** (между canvas и панелью ассетов) - перетащите для изменения высоты панели ассетов
- **Разделители можно двигать до упора** - панели могут быть полностью скрыты или максимально расширены
- **Размеры сохраняются** - настройки панелей запоминаются между сессиями

### View меню

В главном меню доступно меню **View** для управления режимами отображения:

#### Canvas секция:
- **Grid** - переключение отображения сетки на canvas
- **Game Mode** - скрытие всех UI панелей для просмотра уровня в игровом режиме
- **Snap To Grid** - привязка объектов к сетке при размещении и перемещении

#### Object секция:
- **Object Boundaries** - отображение границ всех объектов
- **Object Collisions** - отображение коллизий всех объектов

Все опции сохраняют свое состояние между сессиями и синхронизированы с чекбоксами в меню.

### Навигация по canvas

- **ЛКМ + перетаскивание** - выделение объектов или создание рамки выделения
- **ПКМ + перетаскивание** - перемещение камеры
- **Колесо мыши** - масштабирование (зум)
- **Средняя кнопка мыши + перетаскивание** - интерактивный зум с фиксацией точки
- **Shift + ЛКМ** - добавление к выделению
- **Клик по пустому месту** - снятие выделения

### Контекстные меню

Редактор предоставляет интеллектуальную систему контекстных меню для удобной работы с объектами и видом.

#### Основные принципы работы

- **Правый клик** на canvas или в консоли открывает соответствующее контекстное меню
- **Автоматическое закрытие** - при открытии нового меню все предыдущие автоматически закрываются
- **Предотвращение конфликтов** - одновременно может быть активно только одно меню
- **Интеллектуальное определение** - меню не показывается после панорамирования (перемещения камеры)

#### Canvas контекстное меню

Доступно при правом клике на основной рабочей области:

**Команды для объектов** (отображаются при наличии выделенных объектов):
- **Copy** - копирование выделенных объектов в буфер обмена
- **Cut** - вырезание выделенных объектов
- **Paste** - вставка объектов из буфера обмена
- **Duplicate** - создание копий выделенных объектов
- **Delete** - удаление выделенных объектов
- **Group** - объединение выделенных объектов в группу (требует 2+ выделенных объектов)
- **Ungroup** - разбиение группы на отдельные объекты (доступно при наличии групп в выделении)

**Команды для вида** (доступны всегда):
- **Zoom In** - увеличение масштаба
- **Zoom Out** - уменьшение масштаба
- **Zoom to Fit** - автоматическое масштабирование для показа всех объектов
- **Reset View** - сброс вида к исходному масштабу и положению

#### Console контекстное меню

Доступно при правом клике в области консоли:

**Копирование текста:**
- **Copy message** - копирование текста сообщения
- **Copy with timestamp** - копирование сообщения с временной меткой

**Управление консолью:**
- **Clear console** - очистка всех сообщений
- **Logging on/off** - включение/выключение логирования

#### Особенности поведения

- **Непрерывный мониторинг во время анимации** - позиция курсора отслеживается каждый кадр во время появления меню
- **Мгновенное закрытие при выходе** - меню закрывается немедленно если курсор вышел за границы во время анимации
- **Надежная защита от быстрых движений** - предотвращает все проблемы с резким перемещением курсора
- **Умное позиционирование** - меню автоматически корректирует позицию, чтобы курсор оказался внутри границ
- **Защита от преждевременного закрытия** - меню не закрывается сразу после открытия, даже если курсор находится на границе
- **После панорамирования** - если вы перемещали камеру правой кнопкой мыши, контекстное меню не появится при отпускании кнопки
- **Простой клик** - при простом нажатии без движения меню появляется сразу
- **Автоматическое закрытие** - меню закрывается автоматически при уводе курсора за границы меню (с 2px отступом)
- **Закрытие по клику** - меню также закрывается при клике внутри него
- **Горячие клавиши** - многие команды доступны через горячие клавиши для быстрой работы

### Интерактивный зум

Редактор поддерживает два способа масштабирования:

#### Колесо мыши
- **Прокрутка вверх** - увеличение масштаба
- **Прокрутка вниз** - уменьшение масштаба
- **Зум происходит относительно позиции мыши**

#### Средняя кнопка мыши (интерактивный зум)
- **Нажмите и удерживайте** среднюю кнопку мыши
- **Перетаскивайте вниз** - увеличение масштаба
- **Перетаскивайте вверх** - уменьшение масштаба
- **Зум происходит относительно точки нажатия** - точка под курсором остается зафиксированной
- **Визуальная обратная связь** - курсор меняется на лупу (zoom-in)

**Преимущества интерактивного зума:**
- Точный контроль над областью зума
- Возможность плавного изменения масштаба
- Интуитивное управление направлением зума

## Работа с объектами

### Размещение объектов

1. Выберите категорию ассетов в нижней панели (Tiles, Enemies, Items, Prefabs)
2. Кликните на нужный ассет для выбора
3. Перетащите ассет на canvas в нужное место
4. Объект будет создан и автоматически выделен

### Выделение объектов

- **Одиночный клик** - выделить объект
- **Shift + клик** - добавить/убрать из выделения
- **Перетаскивание** - создать рамку выделения
- **Клик по пустому месту** - снять выделение

### Перемещение объектов

1. Выделите объект(ы)
2. Перетащите выделенные объекты в новое место
3. Объекты будут перемещены и их свойства обновятся

### Удаление объектов

1. Выделите объект(ы) для удаления
2. Нажмите клавишу **Delete** или **X**
3. Объекты будут удалены из уровня

### Дублирование объектов

1. Выделите объект(ы) для дублирования
2. Нажмите **Shift + D**
3. Переместите мышь в нужное место - копии будут следовать за курсором
4. Кликните для размещения копий на уровне
5. Нажмите **Esc** или **ПКМ** для отмены дублирования

**Особенности:**
- Все копии сохраняют свои относительные позиции
- Работает как с отдельными объектами, так и с группами
- Превью отображается с полупрозрачностью (70%)

**Подсветка при дублировании (улучшено в v2.3.2):**
- ✅ **Полная подсветка выделения** - дубликаты отображаются с той же подсветкой, что и обычные объекты
- ✅ **Подсветка групп** - внешняя рамка группы следует за курсором
- ✅ **Подсветка иерархии** - вложенные группы корректно подсвечиваются и следуют за курсором
- ✅ **Затухание по глубине** - прозрачность подсветки уменьшается для глубоко вложенных групп

## Группировка объектов

### Создание группы

1. Выделите несколько объектов (минимум 2)
2. Нажмите **Shift + G**
3. Объекты будут объединены в группу

### Работа с группами

- Группы отображаются в панели Outliner
- Можно редактировать имя группы в панели Details
- Группы можно перемещать как единый объект
- Дочерние объекты группы перемещаются относительно группы

### Режим редактирования групп

1. Двойной клик по группе в Outliner или на canvas
2. Группа переходит в режим редактирования
3. Можно выделять и перемещать объекты внутри группы
4. **Alt + перетаскивание** - перемещение объекта за пределы группы
5. **Esc** - выход из режима редактирования группы
6. **Alt+g** - удаление выбранной группы (вложенные объекты сохраняются)

**Особенности режима:**
- Внешние объекты также доступны для выделения
- Приоритет выделения: группы → внешние объекты → объекты внутри группы
- Alt+drag работает с проверкой пересечения границ

### Автоматическое удаление пустых групп

Level Editor автоматически поддерживает чистоту иерархии проекта, удаляя пустые группы.

**Когда происходит автоматическое удаление:**

1. **При перетаскивании объектов из группы**
   - Если вытащить все объекты из группы, она будет удалена автоматически
   - Работает при обычном перетаскивании и Alt+drag из режима редактирования

2. **При удалении объектов (Delete/X)**
   - Если удаляемые объекты были единственными в группе, группа исчезнет
   - Проверяются все родительские группы удаляемых объектов

3. **При закрытии режима редактирования группы (Esc)**
   - Если во время редактирования группа опустела, она удалится при выходе из режима

**Защитные механизмы:**
- Группы в активном режиме редактирования не удаляются
- Удаляются только полностью пустые группы (0 детей)
- Система работает с вложенными группами любой глубины

**Преимущества:**
- Поддерживает чистую иерархию проекта
- Предотвращает накопление "мусорных" пустых групп
- Работает незаметно для пользователя
- Не мешает нормальной работе с группами

### Создание префабов

1. Создайте группу объектов
2. Перетащите группу на панель ассетов (в область Prefabs)
3. Введите имя префаба
4. Префаб будет добавлен в библиотеку ассетов

## Панель свойств (Details)

### Редактирование свойств

- **Name** - имя объекта
- **Type** - тип объекта
- **X, Y** - позиция объекта
- **Width, Height** - размеры объекта
- **Color** - цвет объекта (для объектов без изображения)

### Множественное выделение

При выделении нескольких объектов:
- Показываются только общие свойства
- Изменение свойства применяется ко всем выделенным объектам
- Если значения различаются, поле показывается пустым

## Панель иерархии (Outliner)

### Навигация по иерархии

- Объекты сгруппированы по типам
- Группы показывают иерархическую структуру
- Двойной клик по заголовку типа сворачивает/разворачивает группу
- Клик по объекту выделяет его на canvas

### Управление группами

- Группы отображаются с отступом для дочерних объектов
- Можно выделять как группы, так и отдельные объекты
- Группы показывают количество дочерних элементов

## Панель статистики (Level)

### Информация об уровне

- **Total Objects** - общее количество объектов
- **Groups** - количество групп
- **By Type** - распределение объектов по типам

## Горячие клавиши

### Основные операции

- **Ctrl/Cmd + Z** - отменить (Undo)
- **Ctrl/Cmd + Y** или **Ctrl/Cmd + Shift + Z** - повторить (Redo)
- **Delete** или **X** - удалить выделенные объекты
- **Shift + D** - дублировать выделенные объекты
- **Shift + G** - создать группу из выделенных объектов
- **Esc** - отменить текущее действие (дублирование, размещение, выделение)
- **ПКМ** - отменить текущее действие

### Навигация

- **F** - сфокусироваться на выделенных объектах
- **A** - сфокусироваться на всех объектах
- **Колесо мыши** - масштабирование
- **ПКМ + перетаскивание** - перемещение камеры

### Работа с группами

- **Двойной клик по группе** - войти в режим редактирования группы
- **Alt + перетаскивание** - переместить объект за пределы группы (в режиме редактирования)
- **Esc** - выйти из режима редактирования группы

## Работа с файлами

### Создание нового уровня

1. Меню **Level** → **New Level**
2. Подтвердите создание нового уровня (если есть несохраненные изменения)

### Открытие уровня

1. Меню **Level** → **Open Level...**
2. Выберите файл уровня (.json)
3. Уровень будет загружен

### Сохранение уровня

1. **Level** → **Save Level** - сохранить с текущим именем
2. **Level** → **Save Level As...** - сохранить с новым именем
3. Файл будет скачан в формате JSON

## Настройки

### Путь к ассетам

1. Меню **Settings** → **Assets Path...**
2. Укажите путь к папке с ассетами
3. Ассеты будут загружены в библиотеку

## Советы и рекомендации

### Организация работы

1. **Используйте группы** для логической организации объектов
2. **Создавайте префабы** для часто используемых комбинаций объектов
3. **Именуйте объекты** для легкой идентификации
4. **Регулярно сохраняйтесь** для предотвращения потери работы

### Производительность

1. **Используйте зум** для работы с деталями
2. **Сворачивайте группы** в Outliner для лучшей производительности
3. **Ограничивайте количество объектов** на одном уровне

### Отладка

1. **Проверяйте статистику уровня** для контроля количества объектов
2. **Используйте Outliner** для навигации по сложным уровням
3. **Проверяйте свойства объектов** в панели Details

## Решение проблем

### Объекты не отображаются

- Проверьте, что объект не скрыт (visible = true)
- Убедитесь, что объект находится в видимой области canvas
- Проверьте, что изображение ассета загружено корректно

### Не работает выделение

- Убедитесь, что кликаете именно по объекту
- Проверьте, что объект не заблокирован (locked = false)
- Попробуйте увеличить масштаб для точного клика

### Проблемы с сохранением

- Убедитесь, что браузер поддерживает загрузку файлов
- Проверьте, что нет ошибок в консоли браузера
- Попробуйте сохранить с другим именем файла

### Медленная работа

- Уменьшите количество объектов на уровне
- Сверните неиспользуемые группы в Outliner
- Перезагрузите страницу для очистки памяти

## Поддержка

При возникновении проблем:
1. Проверьте консоль браузера (F12) на наличие ошибок
2. Убедитесь, что используете современный браузер
3. Попробуйте перезагрузить страницу
4. Проверьте, что все файлы загружены корректно
